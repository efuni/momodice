
## MOMO_DND_PROJECT 说明文档
*对应版本 : 0.22.1及以上*

MOMO_DND_PROJECT是一个为DnD研发的跑团机器人项目(以下简称为桃桃姬)。  
桃桃姬可以胜任大部分你们在网络平台游玩DnD过程中需要进行的检定，并且能够承担一部分记录工作。  
如果你是一名老练的DnD玩家，你可以直接从跳过第零章，从第一章开始了解。  

------

### 〇、术语
#### 骰子  
什么是骰子？在DnD的世界中(万物均由骰子构成)，无时不刻需要使用到骰子。  
对于六面骰你一定相当熟悉，它的6个面分别记录了1至6的数字。然而包含六面骰在内我们需要使用到4面骰(D4)，6面骰(D6)，8面骰(D8)，两种10面骰(D10)，12面骰(D12)，以及最常用的20面骰(D20)。  
抛出骰子，你会得到相应的结果。这些结果(数值)通常会对应游戏中的相应展开。  
#### 伤害类型  
桃桃姬需要处理任何有关伤害类型的标签或指令时，推荐使用以下标准术语。  
穿刺,挥砍,钝击,强酸,冷冻,火焰,力场,闪电,黯蚀,毒素,心灵,光耀,雷鸣  
如果你不这么做，部分功能会受到限制甚至无法执行。  

------

### 一、基础检定
DnD世界中，一切事件均会遵循投掷出的结果展开。你需要了解如何进行基础检定。  

1. **如何抛出骰子**  
一切形如<kbd>.rd</kbd>或<kbd>.rxdy</kbd>或<kbd>.d</kbd>或<kbd>.xdy</kbd>的指令均会被桃桃姬认可。x与y为选填，其中x对应骰子数量(默认为1)，y对应骰子面数(默认为20)。我们可以看一些范例:    
> .d 投掷一个20面骰  
.2d 投掷两个20面骰  
.4d12 投掷4个12面骰  
.8d6 投掷8个六面骰  

2. **如何进行复杂的骰子表达式的运算**  
你可以像使用正常运算一般在骰子表达式中使用加减乘除。尝试理解以下内容:  
> .d+(d+2d+6d12+3)/d  

!> 请注意，检定的开头请务必以.xdy或.rxdy的形式。请避免括号等特殊符号的出现。如果你如论如何都需要使用特殊符号在表达式的开头，请将开头替换为 .0d+ 或 .d0+。

------

### 二、其他指令
<kbd>.msg_off</kbd> 关闭群消息监听  
  
<kbd>.msg_on</kbd> 开启群消息监听   

------

### 三、角色构成
很多情况下，我们的检定会变得比想象中的复杂。伴随着角色的成长，与获得的新能力，检定会需要增加各种各样的参数。有时，一个动作会需要多种检定同时协作。如果你分别为每种检定进行投掷，会浪费大量的时间。创建你的角色，并把它们告诉桃桃姬。这样她就可以代替你进行更加复杂的检定。  

!> 请注意，一个qq账号在同一时间只可以选中一名角色。无论你身处哪里，桃桃姬只会认准你的qq账号为唯一id。

使用<kbd>.set</kbd>指令以创建你的角色。  
.set <kbd>种族</kbd>,<kbd>职业与职业等级</kbd>,<kbd>生命值</kbd>,<kbd>当前生命值</kbd>,<kbd>当前剩余生命骰</kbd>,<kbd>力量</kbd>,<kbd>敏捷</kbd>,<kbd>体质</kbd>,<kbd>智力</kbd>,<kbd>感知</kbd>,<kbd>魅力</kbd>,<kbd>护甲等级</kbd>,\[<kbd>武器名(简洁即可)</kbd> <kbd>熟练武器(熟练项填1,非熟练填0)</kbd> <kbd>使用属性(STR或DEX,也可以是数字)</kbd> <kbd>伤害</kbd>\],\[<kbd>武器2,如果没有填None</kbd>\],\[<kbd>武器3,如果没有填None</kbd>\],\[<kbd>武器4,如果没有填None</kbd>\],<kbd>人物等级</kbd>,<kbd>人物名</kbd>,\[<kbd>技能与特质</kbd>\]  

示例如下:   

> .set 矮人,游侠7 \*法师2 战士,58,58,6,19,14,16,8,10,12,20,[弓 1 DEX 1D6+1],None,None,None,5,德拉克小战锤,[历史 奥秘* 调查* 敏捷豁免 体质豁免 隐匿 苦痛魔爆+ 幸运石+]

在你的角色创建完成后，使用<kbd>.select</kbd>指令选择你所创建的角色。  

> .select 德拉克小战锤   

在选中角色后尝试使用<kbd>.output</kbd>功能导出你的角色，这项指令包含了一系列查错机制，如果能够执行成功，说明你所创建的角色数据格式大致无误。  

#### 进阶录入规则  

**职业与职业等级**  
如果你选用了兼职规则，请用空格隔开复数职业。主要施法者职业请在职业前加注<kbd>*</kbd>。示例如下:  
> 游侠7 *法师10 战士2  

**武器**  
* 如果一件物品拥有魔法物品所带来的加值(例如+1)，你可以在伤害公式的最后加入这个加值。   
* 如果你在伤害后增加伤害类型的标签，那么桃桃姬会分类计算伤害。  
* 伤害表达式中首个被贴上的伤害类型标签会默认为武器伤害标签。它将会被计入各项加值，例如属性调整值、魔法物品加值等等。
 
> [霜刺 1 DEX 1D6<穿刺>+1D4<寒冷>+1]  

!> 请不要为物品的魔法加值附加伤害类型标签。以下的示例是错误的，请不要这样做，否则会导致桃桃姬无法辨认魔法物品加值:  
[霜刺 1 DEX 1D6<穿刺>+1D4<寒冷>+1<寒冷>]  

* 如果武器数据时将使用属性改为了数字，例如8，那么在进行攻击判定时会将此值视为攻击加值，而不会计算你的人物属性属性带来的加值。并且伤害检定中不会使用此加值。  
> [弓 1 8 1D6+1]  

**技能与特质**  
技能与特质，包括了以下的功能:  
> 技能熟练项与专精技能  
被动特质  
计算充能的物品  
伤害易伤、抗性与免疫(测试中特性)

每一条项目用空格隔开,专精技能(双倍熟练加值)后加<kbd>*</kbd>,被动特质后加<kbd>+</kbd>,伤害抗性、免疫相关后加<kbd>-</kbd>,优势技能后加<kbd>=</kbd>。  

------

### 四、进阶检定和功能
在上传并选择了你的角色后，桃桃姬可以执行如下的检定功能。

#### 法术检定  
法术检定是桃桃姬的一个独立模块，收录了PHB中的所有法术以及大部分拓展中500多项法术信息。  
该模块由于年代久远，计划更新架构。暂时不支持某些新功能。  
使用<kbd>..m</kbd> <kbd>法术名称</kbd> <kbd>可选检定参数</kbd>指令进行法术检定。  
如果你使用法术检定，那么桃桃姬会同时扣除相应的环位资源。当前剩余的环位可使用指令<kbd>.环位</kbd>查看，使用指令<kbd>..longrest</kbd>可恢复所有环位。若不希望消耗环位，请在可选参数中增加<kbd>特殊</kbd>参数。    
* 法术升环检定  
在名称后加入<kbd>+x</kbd>的检定参数(不需要空格)。示例如下:  
> ..m 魔法飞弹+4  
..m 炽热射线+3 优势  

#### 属性与技能检定  
属性检定的名称请参考PHB中的译名。  
使用<kbd>..s</kbd> <kbd>属性名称</kbd> <kbd>可选检定参数</kbd>指令进行属性与技能检定。示例如下:    
>..s 体质豁免 优势  
..s 智力  
..s 求生

#### 攻击与伤害检定  
根据你录入的四种武器名称攻击配合人物调整值进行相应的检定。如果名称未填写，会默认为拳击。  
使用<kbd>..a</kbd> <kbd>武器名称</kbd> <kbd>可选检定参数</kbd>指令进行攻击与伤害检定。示例如下:  
>..a 优势  
..a 斧 劣势  

**进阶功能:选定目标**  
你可以在命令的结尾使用qq聊天中的@功能。如果这么做，桃桃姬会自动搜寻该成员创建的主要角色并根据该角色的抗性、免疫和易伤进行伤害调整。  
此功能主要用于简化玩家计算自己受到伤害的流程，推荐DM使用。出于对怪物数据保密等因素，不推荐玩家使用。此外，该功能暂不支持随从模块。  
示例如下：  
>..a 斧 优势 无情@新人的水果  
  
当一名玩家通过随从模块同时控制多个角色时，@功能无法满足选定特定目标的要求。  
你可以在命令后加上
>*=名称1,名称2,名称3*  
*=名称*  

这样桃桃姬就会在当前群内搜索已经被创建的角色的名字。并将他们设为本次行动的目标。  
尝试理解以下指令:  
>..a 斧 优势 光翼 =德拉克战锤,德拉克铁锤  
..a 长弓 咒剑 劣势 =德拉克小战锤  

#### 特质与物品检定  
伴随着角色的成长，你的角色会获得各种各样的可以使用的特质与物品。他们的检定很难通过上述模块来完成。因此诞生了特质与物品检定模块。  
使用<kbd>..c</kbd> <kbd>技能名称</kbd>指令进行职业技能检定。示例如下:  
>..c 拨挡飞弹  
..c 火行者  
..c 狂暴  
..c 欢欣之息  

##### 术士职业检定  
生成法术位:需要生成的法术位请用空格隔开，会消耗相应的术法点。
生成术法点:用于转换成术法点的法术位请用空格隔开，如果满足转换条件，它们会被消耗掉。
>..c 生成法术位 1 1 2  
..c 生成术法点 1 1 2 2 5  
..c 超魔法 3  

##### 法师职业检定  
>..c 奥术回想 1 1 2  

##### 战士职业检定  
>..c 回气  

##### 野蛮人职业检定  
>..c 狂暴  

#### 生命计算  
你随时可以通过以下指令来控制你的当前生命值/最大生命值/临时生命值。  
>..+5 (增加5点HP)  
..-10 (减少10点HP)  
..+6t (增加6点临时生命值)  
..-10l (减少10点最大生命值,这个效果是临时的，不会影响到你原本的最大生命值。)  

#### 生命骰计算  
你随时可以通过以下指令来控制你的生命骰。注意的是生命骰也会随着长休恢复。  
生命骰功能是一个未开发完全的简易的模块，目前只能提供最基本的计数功能，如果你启用了兼职，那么你很可能需要手动记录生命骰。  
>..生命骰+5 (增加5颗生命骰)  
..hd-10 (减少10颗生命骰)  

### 五、时间  
时间在dnd中是一个较为模糊的概念。它具体体现在战斗轮次、昼夜更替中。  
#### 战斗 
在战斗时，你会获得各种各样的效果，他们多半会伴随着时间限制对你的人物进行修正。这可以体现为属性的升降或行为模式的变化。  
如果你需要引入时间(轮次)系统，那么在每个你的回合开始时，你需要进行一次回合开始与结束检定。  
某些物品或特质会给予你回合开始和结束时进行检定的效果。当你拥有这样的效果越多，每次回合开始与结束时的检定会变得更加繁琐。  
使用<kbd>..turn</kbd>或<kbd>..t</kbd>进行回合开始与结束检定。  
##### 战斗轮  
要使用战斗轮的相关功能，需要首先了解DnD战斗轮次的相关知识。
使用<kbd>.所有角色</kbd>查看同一个群组内的所有玩家创建的角色。  
使用<kbd>.召唤 生物名称*n</kbd>召唤数量为n的生物，并为他们按顺序编号。如果你不填写数量，那么只会召唤1名生物。  
使用<kbd>.先攻检定</kbd>使所有角色和生物进行先攻检定，并生成顺序表。  
使用<kbd>.开始</kbd>或<kbd>.开始战斗</kbd>根据已经创建的先攻顺序表开始一场战斗。  
使用<kbd>.结束</kbd>结束你当前的回合。  
使用<kbd>.加入 生物名称*n</kbd>在战斗开始后中途加入n名生物并根据先攻检定结果加入顺序表。  
使用<kbd>.离开 生物名称</kbd>或<kbd>.死亡 生物名称</kbd>使得某名生物离开战斗。  
使用<kbd>.先攻</kbd>查看当前先攻顺序表。  
需要注意的是当轮到某个玩家控制的生物的轮次时，桃桃姬会自动将你当前控制的生物切换为该生物。  


#### 昼夜更替
我们不妨将视角放的宏观一些。在DnD世界的冒险中，伴随着昼夜更替，你的能力或者具有充能的魔法物品会重新变得可以使用。  
使用<kbd>..longrest</kbd>后，你的物品会根据其特性重新获得充能。  

------

### 六、可选参数  
检定参数会改变检定的规则，它可能会改变检定骰的大小，也可以是改变检定的规则。
检定参数和命令需要使用空格隔开，同样，一条命令中如果含有多个检定参数，也同样需要用空格将他们隔开。比如:  
>..m name -a -s  

#### 通用可选检定参数  
* <kbd>-a</kbd>或<kbd>优势</kbd>   
适用范围:任何需要攻击检定的指令。    
具体作用:详见PHB优势相关说明。  
* <kbd>-d</kbd>或<kbd>劣势</kbd>   
适用范围:任何需要攻击检定的指令。    
具体作用:详见PHB劣势相关说明。  
* <kbd>-s</kbd>或<kbd>副手</kbd>   
适用范围:武器攻击检定。    
具体作用:为检定添加副手效果修正。  
* <kbd>-sp</kbd>或<kbd>特殊</kbd>   
适用范围:法术检定。  
具体作用:无视环位进行法术检定。  
* <kbd>-ct</kbd>或<kbd>重击</kbd>   
适用范围:含有攻击检定的指令。  
具体作用:无视重击判定达成重击。  


#### 职业可选检定参数  
* <kbd>-sa</kbd>或<kbd>偷袭</kbd>   
适用范围:攻击检定。游荡者职业限定。  
具体作用:在伤害骰中加入偷袭调整参数。  
* <kbd>-hc</kbd>或<kbd>咒剑</kbd>   
适用范围:伤害检定。邪术师职业限定。  
具体作用:在攻击骰中加入重击调整参数，在伤害骰中加入咒剑诅咒调整参数。  
* <kbd>-gfb</kbd>或<kbd>翠炎剑</kbd>   
适用范围:攻击检定。施法者职业。  
具体作用:详见翠炎剑法术描述。 
* <kbd>-bb</kbd>或<kbd>轰雷剑</kbd>   
适用范围:攻击检定。施法者职业。  
具体作用:详见轰雷剑法术描述。 
* <kbd>-bl</kbd>或<kbd>祝福</kbd>   
适用范围:详见祝福术。 
* <kbd>-ba</kbd>或<kbd>灾祸</kbd>   
适用范围:详见灾祸术。  
* <kbd>-mo</kbd>或<kbd>月镰</kbd>  
适用范围:治疗系法术检定。  
具体作用:治疗系法术增加1D4的回复骰。  
* <kbd>-ds</kbd>或<kbd>灵袭</kbd>  
适用范围:游侠。  
具体作用:伤害检定增加1D4(11级后为1D6)心灵伤害骰。  
* <kbd>-dis</kbd>或<kbd>神击</kbd>  
适用范围:牧师。  
具体作用:伤害检定增加1D8(11级后为2D8)光耀伤害骰。  
* <kbd>-hw</kbd>或<kbd>光翼</kbd>  
适用范围:阿斯莫种族。  
具体作用:伤害检定增加等同于你人物等级的光耀伤害。  
* <kbd>-gr</kbd>或<kbd>无情</kbd>  
适用范围:获得了无情者护符并与之同调的角色。  
具体作用:杀死一个生物后，下一次攻击检定取得优势，并增加1D10的黯蚀伤害骰。  
 
------
### 七、特质  

你的人物在伴随着冒险会得到成长，这可以体现为一件能增强你的物品，亦或是一种特质。   
在录入特质时，需要在特质后加上<kbd>+</kbd>。示例：   
>[体质豁免 巧手* 苦痛魔爆+ 防护斗篷+ 火焰抗性- 光耀免疫-]

#### 通用特质  
* <kbd>苦痛魔爆</kbd>  
适用范围:邪术师    
具体作用:施展*魔能爆 eldritch blast*时，你可以将魅力调整值加到其每次命中所造成的伤害中。  
* <kbd>凶蛮重击</kbd>  
适用范围:野蛮人    
具体作用:详见PHB相关说明。  
* <kbd>幸运石</kbd>  
适用范围:任何获得幸运石物品或相同特质的角色。    
具体作用:属性与豁免检定获得+1加值。  
* <kbd>防护斗篷</kbd>  
适用范围:任何获得防护斗物品或相同特质的角色。    
具体作用:豁免检定获得+1加值。  
* <kbd>生命门徒</kbd>  
适用范围:牧师    
具体作用:详见技能相关说明。  
* <kbd>神佑医者</kbd>  
适用范围:牧师    
具体作用:详见技能相关说明。  
* <kbd>妖冶娴都</kbd>  
适用范围:游侠    
具体作用:详见技能相关说明。  
* <kbd>什米克之戒(绿)</kbd>  
适用范围:任何获得什米克之戒(绿)物品或相同特质的角色。   
具体作用:当你的回合开始时，进行一次d6检定，若结果大于等于3，获得1D6+1点临时生命值。  
* <kbd>扎卡的尖刺手套</kbd>  
适用范围:任何获得扎卡的尖刺手套物品或相同特质的角色。   
具体作用:你的徒手打击增加1点穿刺伤害。  

------
### 八、随从
如果你是法师或者是邪术师等职业，亦或者招募了随从，那么你很可能需要操纵你复数角色进行检定。你不必每次使用.select命令切换角色。桃桃姬提供了随从模块让你可以进行快捷的检定。

#### 召唤随从    
在使用<kbd>.select</kbd>命令选中了你的角色后，使用<kbd>..pset</kbd>指令就可以从你上传的角色中召唤一名作为随从。示例如下:  
>..pset 德拉克铁锤

!> 请注意桃桃姬目前不支持一名角色拥有复数的随从。如果你无论如何都需要使用多名随从(尽管我非常不推荐这样做)，请尝试为随从召唤随从。

#### 随从检定    
随从模块的设计理念源自于便捷，因此不会有任何额外的指令。如果你需要使用你的随从进行检定，只需要在<kbd>指令</kbd>与<kbd>..</kbd>中添加一个<kbd>p</kbd>即可。尝试理解以下指令：
>..pa 长弓 优势  
..ps 体质豁免 劣势  
..pm 魔法飞弹+4 咒剑  
..ppset 德拉克铜锤  
..plongrest  
..pc 狂暴  

------

### 终、更新与开发日志  
#### 开发中的功能   
*随机地下城生成模块*   
*地下城模块*   
*随机生物生成模块*    
*随机护甲生成模块*   
*随机物品生成模块*   

------

#### 更新日志 0.22  
##### 0.22.1  
*更新战斗轮系统。*  
##### 0.22.0  
*添加了战斗轮系统。*  
*现在开始法术检定会显示每个骰子的大小。*  

#### 更新日志 0.21  
##### 0.21.5   
*现在你可以通过指定名字的方式来选定目标。*  
*增加了生命计数相关功能*  
*现在攻击会分别判定目标的AC值并根据抗性免疫易伤属性计算实际伤害。*  
*现在攻击命中目标的同时会触发目标身上需要专注法术的体质豁免。*  
##### 0.21.4   
*现在为攻击指定目标后可以判断目标的抗性以及护甲值。*
##### 0.21.3   
*添加术士模块*
##### 0.21.2   
*添加随机武器生成模块。*
##### 0.21.1   
*现在单次攻击检定可以指定多个目标。*
##### 0.21.0  
*现在攻击检定可以根据目标的抗性等计算实际造成的伤害。*
*修复了一些罕见的bug。*

#### 更新日志 0.20  
##### 0.20.2  
*更新特质与检定参数*
##### 0.20.1  
*修复了开关型特质在同一回合关闭后再开启不会实时更新的问题。*
##### 0.20.0  
*添加了物品模块。*
*物品检定现在可以在<kbd>..c</kbd>特质与物品检定中使用。*  
*现在短休会清除较短的buff效果，而长休会回复物品充能。*  

#### 更新日志 0.19  
##### 0.19.2  
*添加了buff模块。*  
*现在剩余时间大于10轮的buff会以分钟显示*  
##### 0.19.1  
*添加了光翼检定参数。*  
##### 0.19.0  
*修复了武器录入无法将挥砍、穿刺和钝击以外的伤害类型识别为主武器伤害类型的问题。*   
*添加了回合开始与结束检定模块。*   

#### 更新日志 0.18  
*更新日志及说明文档转移到Github*  
*添加了随从模块。*  
*更新检定参数库。*  